let userBodyParams,authorizeUserQuery,insertUserQuery,selectByUsername,generateToken,validateRequestParams;_a43‍.x([["authorizeUser",()=>authorizeUser],["registerUser",()=>registerUser],["getUserInfo",()=>getUserInfo]]);_a43‍.w("./schema",[["userBodyParams",["userBodyParams"],function(v){userBodyParams=v}]]);_a43‍.w("./queries",[["authorizeUserQuery",["authorizeUserQuery"],function(v){authorizeUserQuery=v}],["insertUserQuery",["insertUserQuery"],function(v){insertUserQuery=v}],["selectByUsername",["selectByUsername"],function(v){selectByUsername=v}]]);_a43‍.w("./utils",[["generateToken",["generateToken"],function(v){generateToken=v}],["validateRequestParams",["validateRequestParams"],function(v){validateRequestParams=v}]]);







       const authorizeUser = async (req, res) => {
  try {
    const { rows } = await authorizeUserQuery(req.body);

    if (rows.length === 0) {
      return res.status(401).send('Invalid login or password');
    }

    res.json({ token: generateToken(rows[0]) });
  } catch (err) {
    res.status(500).json(err.toString());
  }
};

       const registerUser = async (req, res) => {
  try {
    const { rows } = await selectByUsername(req.body);

    if (rows.length > 0) {
      return res.status(409).send('A user with this name already exists');
    }

    await insertUserQuery(req.body);

    res.json({ token: generateToken(req.body) });
  } catch (err) {
    res.status(500).json(err.toString());
  }
};

       const getUserInfo = async (req, res) => {
  res.json({ username: req.user.username });
};
